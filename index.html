<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piker Reset</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; text-align: center; }
        #reader { width: 100vw; height: 60vh; background: #000; }
        #result { background: #fff; color: #000; min-height: 40vh; padding: 20px; border-radius: 20px 20px 0 0; }
        .btn { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; margin: 10px; }
    </style>
</head>
<body>

    <div id="reader"></div>
    <div id="result">
        <button class="btn" onclick="startScanner()">۱. باز کردن دوربین</button>
        <div id="out">منتظر اسکن...</div>
    </div>

    <script>
        const scanner = new Html5Qrcode("reader");
        let allItems = [];

        function startScanner() {
            const config = { fps: 10, qrbox: 250 };
            scanner.start({ facingMode: "environment" }, config, (text) => {
                // تایید اسکن با ویبره
                if (navigator.vibrate) navigator.vibrate(100);
                
                try {
                    const data = JSON.parse(text);
                    document.getElementById('out').innerHTML = "✅ فاکتور ثبت شد: " + data[0];
                    // منطق تجمیع شما اینجا قرار می‌گیرد
                } catch(e) {
                    document.getElementById('out').innerHTML = "⚠️ کد خوانده شد ولی فرمت آن JSON نیست!";
                }
            }).catch(err => {
                alert("خطا: دوربین پیدا نشد یا اجازه دسترسی ندارید.");
            });
        }
    </script>
</body>
</html>
