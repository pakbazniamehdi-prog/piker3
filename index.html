<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Piker Industrial v10</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: Tahoma; background: #f0f0f0; margin: 0; text-align: center; }
        .header { background: #222; color: white; padding: 10px; position: sticky; top: 0; z-index: 100; }
        .slot-bar { display: flex; justify-content: space-around; background: white; padding: 10px; border-bottom: 2px solid #ccc; }
        .slot { border: 2px solid #aaa; border-radius: 8px; width: 18%; padding: 5px; font-size: 10px; background: #eee; }
        .slot.active { border-color: #3182ce; background: #ebf8ff; }
        .slot.done { border-color: #38a169; background: #f0fff4; }
        input[type="file"] { display: none; }
        .group-box { background: white; margin: 15px; border-radius: 10px; text-align: right; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden; }
        .p-name { background: #ddd; padding: 8px 15px; font-weight: bold; }
        .item-line { padding: 10px; display: flex; justify-content: space-between; border-bottom: 1px solid #eee; border-right: 10px solid var(--c); }
        .qty { background: #222; color: white; padding: 2px 8px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">Piker: ØªÙÚ©ÛŒÚ© Ú©Ø§Ù„Ø§ÛŒÛŒ (Ûµ Ø¬Ø§ÛŒÚ¯Ø§Ù‡)</div>

<div class="slot-bar">
    <label class="slot" id="sl0">Û±<input type="file" accept="image/*" capture="environment" onchange="up(0,this)"><div id="m0">â­•</div></label>
    <label class="slot" id="sl1">Û²<input type="file" accept="image/*" capture="environment" onchange="up(1,this)"><div id="m1">â­•</div></label>
    <label class="slot" id="sl2">Û³<input type="file" accept="image/*" capture="environment" onchange="up(2,this)"><div id="m2">â­•</div></label>
    <label class="slot" id="sl3">Û´<input type="file" accept="image/*" capture="environment" onchange="up(3,this)"><div id="m3">â­•</div></label>
    <label class="slot" id="sl4">Ûµ<input type="file" accept="image/*" capture="environment" onchange="up(4,this)"><div id="m4">â­•</div></label>
</div>

<div id="output"></div>
<div id="scanner-temp" style="display:none"></div>

<script>
    let slots = [null, null, null, null, null];
    const colors = ["#3182ce", "#e53e3e", "#38a169", "#d69e2e", "#805ad5"];
    const engine = new Html5Qrcode("scanner-temp");

    async function up(i, el) {
        const file = el.files[0];
        if (!file) return;
        document.getElementById('m'+i).innerText = "â³";

        engine.scanFile(file, true)
        .then(res => {
            slots[i] = JSON.parse(res);
            document.getElementById('sl'+i).className = "slot done";
            document.getElementById('m'+i).innerText = "âœ…";
            render();
        })
        .catch(e => {
            alert("Ø§Ø³Ú©Ù† Ù†Ø´Ø¯! Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.");
            document.getElementById('m'+i).innerText = "âŒ";
        });
    }

    function render() {
        const out = document.getElementById('output');
        out.innerHTML = '';
        let groups = {};

        slots.forEach((data, sIdx) => {
            if (!data) return;
            const customer = data.customer.name;
            const items = data.items;
            Object.keys(items).forEach(k => {
                const it = items[k];
                if (!groups[it.title]) groups[it.title] = [];
                groups[it.title].push({ n: customer, q: it.quantity, c: colors[sIdx] });
            });
        });

        Object.keys(groups).sort().forEach(title => {
            let h = `<div class="group-box"><div class="p-name">ğŸ“¦ ${title}</div>`;
            groups[title].forEach(row => {
                h += `<div class="item-line" style="--c: ${row.c}">
                    <span style="color:${row.c}">ğŸ‘¤ ${row.n}</span>
                    <span><span class="qty">${row.q}</span> <input type="checkbox" style="width:20px;height:20px;margin-right:10px"></span>
                </div>`;
            });
            out.innerHTML += h + `</div>`;
        });
    }
</script>
</body>
</html>
