<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piker Master - Direct Mode</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: Tahoma; background: #0f172a; color: white; text-align: center; padding: 15px; }
        .btn-scan { background: #1e293b; border: 2px solid #38bdf8; padding: 30px; border-radius: 15px; display: block; margin: 10px auto; width: 80%; cursor: pointer; }
        #status { background: #000; padding: 15px; border-radius: 10px; color: #fbbf24; margin: 15px 0; font-size: 13px; border: 1px solid #334155; }
        .product-card { background: #1e293b; border-radius: 12px; margin: 10px 0; padding: 15px; border-right: 5px solid #22c55e; text-align: right; }
    </style>
</head>
<body>

    <h2 style="color:#38bdf8">âš¡ Ù†Ø³Ø®Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…</h2>
    <div id="status">Ø§Ø¨ØªØ¯Ø§ VPN Ø±Ø§ Ø®Ø§Ù…ÙˆØ´ Ú©Ù†ÛŒØ¯ Ùˆ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø¨Ø²Ù†ÛŒØ¯</div>

    <label class="btn-scan">
        <b>ğŸ“· Ø§Ø³Ú©Ù† ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯</b>
        <input type="file" accept="image/*" capture="environment" onchange="directProcess(this)" style="display:none">
    </label>

    <div id="output"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzaaIjPbFOwBwPDPCUAlrFb1eIAAag7LdyRKEn3IB8SOYkkskhc7Zy4JPa8PJqiJEIi/exec';
        const html5QrCode = new Html5Qrcode("status");

        async function directProcess(input) {
            const file = input.files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.innerText = "â³ Ø¯Ø± Ø­Ø§Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† QR...";

            try {
                // Û±. Ø®ÙˆØ§Ù†Ø¯Ù† Ù„ÛŒÙ†Ú© Ø§Ø² Ø¹Ú©Ø³
                const url = await html5QrCode.scanFile(file, true);
                status.innerText = "ğŸ”— Ù„ÛŒÙ†Ú© Ù¾ÛŒØ¯Ø§ Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø³ØªÙ‚ÛŒÙ…...";

                // Û². ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø³ØªÙ‚ÛŒÙ… (CORS Bypass)
                // ØªÙˆØ¬Ù‡: Ø§Ú¯Ø± Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ù‡Ù… Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø§Ù…Ù†ÛŒØª Ø³Ø§ÛŒØª ÙˆØ§Ù„â€ŒÙ…Ø§Ø±Ú©Øª Ù…Ø³Ø¯ÙˆØ¯ Ø´ÙˆØ¯ØŒ 
                // ØªÙ†Ù‡Ø§ Ø±Ø§Ù‡ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø§Ø³Ú©Ù† Ù…ØªÙ† (OCR) Ø§Ø³Øª.
                const res = await fetch(url);
                const html = await res.text();
                
                // Ø§ÛŒÙ†Ø¬Ø§ Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø§Ø² Ø¯Ø§Ø®Ù„ Ù…ØªÙ† HTML Ø³Ø§ÛŒØª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒÙ…
                // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø®ØªØ§Ø± Ø³Ø§ÛŒØª ÙˆØ§Ù„â€ŒÙ…Ø§Ø±Ú©Øª Ø¯Ø§Ø±Ø¯
                status.innerText = "âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ (Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...)";
                
                // ØªØ³Øª: Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù…Ø­ØªÙˆØ§
                console.log(html.substring(0, 500)); 
                
            } catch (err) {
                status.innerHTML = `<span style="color:#ef4444">âŒ Ø®Ø·Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…: ${err.message}</span><br>Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯ÛŒØªØ§ Ø±Ø§ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.`;
            }
        }
    </script>
</body>
</html>
