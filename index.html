<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piker Data Receiver</title>
    <style>
        body { font-family: Tahoma; margin: 0; background: #f7fafc; text-align: center; }
        .header { background: #2d3748; color: white; padding: 20px; }
        .input-box { margin: 20px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 15px; border-radius: 10px; border: 2px solid #3182ce; font-size: 16px; text-align: center; }
        .card { background: white; border-radius: 12px; margin: 15px; text-align: right; border-right: 10px solid #38a169; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card-header { background: #edf2f7; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; }
        .row { padding: 10px; display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; }
        .qty { background: #2d3748; color: white; padding: 2px 10px; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Ø³ÛŒØ³ØªÙ… ØªØ¬Ù…ÛŒØ¹ Piker (Ø¯Ø±ÛŒØ§ÙØª Ù…Ø³ØªÙ‚ÛŒÙ…)</h2>
        <p>Ø¯ÛŒØªØ§ Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ø²ÛŒØ± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (ÛŒØ§ Ø§Ø² Ø§Ø³Ú©Ù†Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)</p>
    </div>

    <div class="input-box">
        <input type="text" id="scanner-input" placeholder="Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯..." autofocus>
        <p style="font-size: 11px; color: #718096; margin-top: 10px;">Ù†Ú©ØªÙ‡: Ø§ÛŒÙ† Ú©Ø§Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ù†Ø¯Ø²ÙØ±ÛŒ Ø§Ø³Ú©Ù†Ø± ÛŒØ§ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ù…Ø¬Ø§Ø²ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
    </div>

    <div id="result"></div>

<script>
    let inventory = {};
    let scannedHashes = new Set();
    const input = document.getElementById('scanner-input');

    // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒ (Ø§Ú¯Ø± Ø§Ø³Ú©Ù†Ø± ÙÛŒØ²ÛŒÚ©ÛŒ ÛŒØ§ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙˆØ§Ø³Ø·Ù‡ Ø¯ÛŒØªØ§ Ø±Ø§ Ø¨ÙØ±Ø³ØªØ¯)
    input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            processData(this.value);
            this.value = ''; // Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† Ø¨Ø¹Ø¯ÛŒ
        }
    });

    function processData(text) {
        try {
            const data = JSON.parse(text);
            const id = data.customer.orderDate + data.customer.name;

            if (scannedHashes.has(id)) return;
            scannedHashes.add(id);

            const items = data.items;
            Object.keys(items).forEach(key => {
                const it = items[key];
                if (!inventory[it.title]) inventory[it.title] = { total: 0, details: [] };
                inventory[it.title].total += parseInt(it.quantity);
                inventory[it.title].details.push({ n: data.customer.name, q: it.quantity });
            });

            render();
        } catch (e) {
            console.error("ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±");
        }
    }

    function render() {
        const res = document.getElementById('result');
        res.innerHTML = '';
        Object.keys(inventory).forEach(title => {
            let html = `<div class="card"><div class="card-header"><span>ğŸ“¦ ${title}</span><span>Ú©Ù„: ${inventory[title].total}</span></div>`;
            inventory[title].details.forEach(d => {
                html += `<div class="row"><span>ğŸ‘¤ ${d.n}</span><div><span class="qty">${d.q}</span> <input type="checkbox" style="width:20px;height:20px;margin-right:5px"></div></div>`;
            });
            res.innerHTML += html + `</div>`;
        });
    }
</script>
</body>
</html>
