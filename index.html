<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piker Ultra Fast - Compressed</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: Tahoma; margin: 0; background: #121212; color: white; text-align: center; }
        #reader { width: 100%; max-width: 500px; margin: auto; border-bottom: 3px solid #00ff00; }
        .list { background: white; color: black; padding: 15px; min-height: 100vh; border-radius: 20px 20px 0 0; margin-top: -10px; }
        .row { border-bottom: 1px solid #ddd; padding: 10px; display: flex; justify-content: space-between; }
        .tag { background: #eee; padding: 2px 5px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <div id="reader"></div>
    <div id="status" style="padding:10px;">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Ú©Ù† (Ù†Ø³Ø®Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡)</div>
    
    <div class="list" id="res">
        <h3 style="color:#333">Ù„ÛŒØ³Øª Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ ØªØ¬Ù…ÛŒØ¹ÛŒ</h3>
        <div id="items">Ù‡Ù†ÙˆØ² ÙØ§Ú©ØªÙˆØ±ÛŒ Ø§Ø³Ú©Ù† Ù†Ø´Ø¯Ù‡</div>
    </div>

    <script>
        let allData = [];
        let scanned = new Set();

        const scanner = new Html5Qrcode("reader");

        function processData(raw) {
            // Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯: Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§ÛŒ ÙØ´Ø±Ø¯Ù‡ (Ù…Ø«Ù„Ø§ S|R:10|B:5)
            // Ø§Ú¯Ø± Ø¯ÛŒØªØ§ÛŒ ØªÙˆ Ù‡Ù†ÙˆØ² JSON Ø§Ø³ØªØŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ù‡ Ù‡Ù…Ø§Ù† JSON.parse Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
            try {
                let data;
                if(raw.startsWith('[')) {
                    data = JSON.parse(raw);
                } else {
                    // Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ ÙØ±Ù…Øª ÙØ´Ø±Ø¯Ù‡: Ø§Ø³Ù…|Ú©Ø§Ù„Ø§:ØªØ¹Ø¯Ø§Ø¯|Ú©Ø§Ù„Ø§:ØªØ¹Ø¯Ø§Ø¯
                    let parts = raw.split('|');
                    let name = parts[0];
                    data = [name];
                    for(let i=1; i<parts.length; i++) {
                        let item = parts[i].split(':');
                        data.push([item[0], parseInt(item[1])]);
                    }
                }

                if(scanned.has(data[0])) return;
                scanned.add(data[0]);

                for(let i=1; i<data.length; i++) {
                    allData.push({ p: data[i][0], q: data[i][1], o: data[0] });
                }
                render();
            } catch(e) { alert("Ú©Ø¯ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯ ÙˆÙ„ÛŒ ÙØ±Ù…Øª Ø¢Ù† Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!"); }
        }

        function render() {
            const div = document.getElementById('items');
            div.innerHTML = '';
            let groups = allData.reduce((acc, curr) => {
                acc[curr.p] = (acc[curr.p] || 0) + curr.q;
                return acc;
            }, {});

            for(let p in groups) {
                div.innerHTML += `<div class="row">
                    <span>ğŸ“¦ <b>${p}</b></span>
                    <span>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: <b>${groups[p]}</b></span>
                </div>`;
            }
        }

        scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => {
            processData(text);
            if(navigator.vibrate) navigator.vibrate(100);
        });
    </script>
</body>
</html>
